var D=Object.defineProperty,v=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var b=(e,o,t)=>o in e?D(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,g=(e,o)=>{for(var t in o||(o={}))I.call(o,t)&&b(e,t,o[t]);if(E)for(var t of E(o))x.call(o,t)&&b(e,t,o[t]);return e},B=(e,o)=>v(e,k(o));import{a as S,d as $,O as M,N,P as T,Z as U,Q as P,R as j,S as O,W as R,V as X,o as F,x as C,n as a,w as l,a2 as z,Y as r,B as m,a3 as J,a4 as Q,v as W}from"./vendor.f8f2c60d.js";import{_ as Y,X as f}from"./index.080f1da2.js";let n=S({active_name:"connectInfo",host_list:Array(),is_login:!1,password:"",old_password:"",new_password_a:"",new_password_b:""});function Z(e,o){new f().delete(`/api/status?session_id=${o.session_id}`).then(p=>p.json()).then(p=>{p.code===0&&A()})}function A(){if(n.is_login){var e=new EventSource("/api/status");e.onmessage=function(o){let t=JSON.parse(o.data);t.code===0&&(n.is_login=!0,n.host_list=t.data)}}}function q(){let e=new FormData;e.append("pwd",n.password),new f().post("/api/login",{body:e}).then(t=>{if(t.status===401){r.error("\u5BC6\u7801\u9519\u8BEF");return}return t.json()}).then(t=>{t.code===0&&(n.is_login=!0,A())})}function G(){if(n.old_password.length===0){r.error("\u65E7\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(n.new_password_a.length===0){r.error("\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(n.new_password_b.length===0){r.error("\u786E\u8BA4\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(n.new_password_a!==n.new_password_b){r.error("\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4");return}let e=new FormData;e.append("old_pwd",n.old_password),e.append("new_pwd",n.new_password_a),new f().patch("/api/login",{body:e}).then(t=>t.json()).then(t=>{t.code===0&&(r.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),n.is_login=!1)})}const H=$({name:"manage",setup(e,o){return B(g({},z(n)),{login:q,disconnect:Z,changePassword:G})}}),K=e=>(J("data-v-1fa48446"),e=e(),Q(),e),L={key:0},ee=m("\u65AD\u5F00"),oe=m("\u63D0\u4EA4"),ae={key:1},te=K(()=>W("h3",{class:"login-title"},"\u8BF7\u767B\u5F55",-1)),le=m("\u767B\u5F55");function ne(e,o,t,p,ue,se){const s=M,_=N,V=T,w=U,i=P,d=j,c=O,h=R,y=X;return e.is_login?(F(),C("div",L,[a(y,{modelValue:e.active_name,"onUpdate:modelValue":o[3]||(o[3]=u=>e.active_name=u),type:"card"},{default:l(()=>[a(w,{label:"\u8FDE\u63A5\u72B6\u6001",name:"connectInfo"},{default:l(()=>[a(V,{data:e.host_list,style:{width:"100%"}},{default:l(()=>[a(s,{fixed:"",prop:"ip",label:"\u5730\u5740",width:"250"}),a(s,{prop:"username",label:"\u7528\u6237\u540D",width:"180"}),a(s,{prop:"port",label:"\u7AEF\u53E3"}),a(s,{prop:"shell",label:"shell"}),a(s,{prop:"session_id",label:"\u4F1A\u8BDDID",width:"200"}),a(s,{prop:"start_time",label:"\u8FDE\u63A5\u521B\u5EFA\u65F6\u95F4",width:"150"}),a(s,{fixed:"right",label:"\u64CD\u4F5C"},{default:l(u=>[a(_,{size:"small",type:"danger",onClick:de=>e.disconnect(u.$index,u.row)},{default:l(()=>[ee]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(w,{label:"\u7BA1\u7406\u5BC6\u7801",name:"second"},{default:l(()=>[a(h,null,{default:l(()=>[a(c,{"label-width":"100px"},{default:l(()=>[a(d,{label:"\u65E7\u5BC6\u7801"},{default:l(()=>[a(i,{type:"password",minlength:"1",maxlength:"64",modelValue:e.old_password,"onUpdate:modelValue":o[0]||(o[0]=u=>e.old_password=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"\u65B0\u5BC6\u7801"},{default:l(()=>[a(i,{type:"password",minlength:"1",maxlength:"64",modelValue:e.new_password_a,"onUpdate:modelValue":o[1]||(o[1]=u=>e.new_password_a=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"\u65B0\u5BC6\u7801"},{default:l(()=>[a(i,{type:"password",minlength:"1",maxlength:"64",modelValue:e.new_password_b,"onUpdate:modelValue":o[2]||(o[2]=u=>e.new_password_b=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(d,null,{default:l(()=>[a(_,{type:"primary",onClick:e.changePassword},{default:l(()=>[oe]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(F(),C("div",ae,[a(h,null,{default:l(()=>[a(c,{"label-width":"80px",class:"login-box"},{default:l(()=>[te,a(d,{label:"\u5BC6\u7801"},{default:l(()=>[a(i,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",modelValue:e.password,"onUpdate:modelValue":o[4]||(o[4]=u=>e.password=u)},null,8,["modelValue"])]),_:1}),a(d,null,{default:l(()=>[a(_,{type:"primary",onClick:e.login},{default:l(()=>[le]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]))}var _e=Y(H,[["render",ne],["__scopeId","data-v-1fa48446"]]);export{_e as default};
